# NBackup Server — Exemplo de Configuração
# Copie para /etc/nbackup/server.yaml e ajuste os valores.

server:
  listen: "0.0.0.0:9847"

tls:
  ca_cert: /etc/nbackup/ca.pem
  server_cert: /etc/nbackup/server.pem
  server_key: /etc/nbackup/server-key.pem

storages:
  scripts:
    base_dir: /var/backups/scripts
    max_backups: 5
    compression_mode: gzip            # gzip|zst (default: gzip)
    assembler_mode: eager             # eager|lazy (default: eager)
    assembler_pending_mem_limit: 8mb  # limite de pending em memória no modo eager

  home-dirs:
    base_dir: /var/backups/home
    max_backups: 10
    compression_mode: zst             # usa Zstandard para compressão mais rápida
    assembler_mode: lazy
    assembler_pending_mem_limit: 8mb

logging:
  level: info                      # debug, info, warn, error
  format: json                     # json, text
  file: /var/log/nbackup/server.log # Log file dedicado (opcional)
  stream_stats: false              # Per-stream stats em sessões paralelas (padrão: false)

# SPA de Observabilidade — listener HTTP separado
web_ui:
  enabled: false                   # Habilita a interface web de observabilidade
  listen: "127.0.0.1:9848"        # Bind interno por padrão (segurança)
  read_timeout: 5s
  write_timeout: 15s
  idle_timeout: 60s
  events_file: /var/lib/nbackup/events.jsonl
  events_max_lines: 10000
  session_history_file: /var/lib/nbackup/session-history.jsonl
  session_history_max_lines: 5000
  active_sessions_file: /var/lib/nbackup/active-sessions.jsonl
  active_sessions_max_lines: 20000
  active_snapshot_interval: 5m
  allow_origins:                   # ACL por IP/CIDR (obrigatória quando enabled)
    - "127.0.0.1/32"
    # - "10.0.0.0/8"              # Descomente para rede interna
