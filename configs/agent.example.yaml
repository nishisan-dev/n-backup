# NBackup Agent — Exemplo de Configuração
# Copie para /etc/nbackup/agent.yaml e ajuste os valores.

agent:
  name: "web-server-01"

server:
  address: "backup.nishisan.dev:9847"

tls:
  ca_cert: /etc/nbackup/ca.pem
  client_cert: /etc/nbackup/agent.pem
  client_key: /etc/nbackup/agent-key.pem

backups:
  - name: "app"
    storage: "scripts"             # Nome do storage no server
    schedule: "0 2 * * *"          # Cron expression (diário às 02h)
    parallels: 0                   # 0=single stream, 1-255=max streams paralelos
    sources:
      - path: /app/scripts
    exclude:
      - "*.log"

  - name: "home"
    storage: "home-dirs"
    schedule: "0 */6 * * *"        # A cada 6 horas
    parallels: 4                   # 4 streams paralelos
    sources:
      - path: /home
      - path: /etc
    exclude:
      - ".git/**"
      - "node_modules/**"
      - "*/tmp/sess*"

retry:
  max_attempts: 5
  initial_delay: 1s
  max_delay: 5m

resume:
  buffer_size: 256mb               # Tamanho do ring buffer (kb, mb, gb)
  chunk_size: 1mb                  # Tamanho de cada chunk paralelo (64kb-16mb, default: 1mb)

logging:
  level: info                      # debug, info, warn, error
  format: json                     # json, text
  file: /var/log/nbackup/agent.log # Log file dedicado (opcional)

daemon:
  control_channel:
    enabled: true                    # Ativa canal de controle persistente com o server
    keepalive_interval: 30s          # Intervalo entre PINGs
    reconnect_delay: 5s              # Delay inicial de reconexão
    max_reconnect_delay: 5m          # Delay máximo de reconexão (exponential backoff)
