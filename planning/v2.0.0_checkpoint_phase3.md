# Checkpoint v2.0.0 — Início Fase 3

## Estado Atual

- **Branch:** `dev-v2.0.0`
- **Fases concluídas:** 1 e 2
- **Último commit:** `eb6b9c5` — `feat(v2): phase 2 — WebUI storages with disk usage`
- **Testes:** 100% passando (`go test ./... -count=1`)

## Fase 3 — Persistência de Eventos

### Objetivo
Persistir eventos do `EventRing` em disco (arquivo append-only) para sobreviver a restarts do servidor.

### Arquivos a criar/modificar

| Ação | Arquivo | Descrição |
|------|---------|-----------|
| **[NEW]** | `internal/server/observability/event_store.go` | Store append-only com rotação por max lines |
| **[NEW]** | `internal/server/observability/event_store_test.go` | Testes do store |
| **[MODIFY]** | `internal/config/server.go` | Campos `EventsFile` e `EventsMaxLines` no `WebUIConfig` |
| **[MODIFY]** | `internal/server/observability/http.go` | Aceitar `EventStore` e servir eventos persistidos |
| **[MODIFY]** | `internal/server/server.go` | Instanciar `EventStore` no startup |
| **[MODIFY]** | `internal/server/observability/event.go` | Integrar `EventStore` no `EventRing.Push()` |

### Decisões de Design Pendentes
1. **Formato:** JSON Lines (`.jsonl`) — 1 evento por linha
2. **Rotação:** Truncar quando exceder `events_max_lines` (default 10000)
3. **Load on startup:** Carregar últimos N eventos do arquivo para popular o `EventRing`
4. **Thread safety:** Mutex exclusivo para writes, reads via snapshot

### Referências de Código

- `EventRing` atual: `internal/server/observability/event.go`
- Config do WebUI: `internal/config/server.go` → `WebUIConfig`
- Startup do servidor: `internal/server/server.go` → onde `EventRing` é criado
- Router: `internal/server/observability/http.go` → `makeEventsHandler()`

### Task.md
Ver `/planning/v2.0.0_plan.md` e artifact `task.md` para checklist completo das fases 3-6.
